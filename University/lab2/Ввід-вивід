/* З клавіатури вводиться номер поїзда, назва сполучення,
час відправлення з початкової станції і час прибуття на
кінцеву, а у файл записується номер поїзда,назва сполучення,
час відправлення з початкової станції і час прибуття на кінцеву
та час у дорозі.
*/
#include<iostream> 
#include<fstream> 
#include<string> 
#include<iomanip> 
#include<ctime>
using namespace std;

int main()
{
	int numbTrain;  // Номер поїзда
	string namePlatf;  // сполучення
	struct tm  depertureTime;// Час відправлення
	struct tm  arrivalTime; // Час прибуття
	
	setlocale(LC_ALL, "Russian");
	while (true)
	{
		cout << "Show data – press 1" << endl;
		cout << "Write data - press 2" << endl;
		cout << "Exit – press 3" << endl;

		int choice;
		cin >> choice;

		if (choice == 1)
		{
			ifstream infile; // Відкриваю файл 
			infile.open("File.txt"); // Читаю з нього
			if (!infile)     // Якщо нема такого - вивести помилку
			{
				cout << "Cannot open file" << endl;
				return -1;
			}
			//Друкуємо шапку з відступом
			cout << setw(20) << "Number train" << setw(20) << "Stantion - Stantion"
				<< setw(20) << "Deperture time" << setw(17) << "Arrival time"
				<< setw(20) <<"In a way"<< endl;
			while (!infile.eof())
			{
				infile >> numbTrain;    //Виводимо numbTrain
				infile >> namePlatf;	//Виводимо namePlatf
				infile >> get_time(&depertureTime, "%R");//Виводимо depertureTime
				infile >> get_time(&arrivalTime, "%R");  //Виводимо arrivalTime
				
				if (!infile.eof())     //Виводити доки не завершиться інформація
				{
						cout.width(20);   // Ширина між кожним надписом
						cout << numbTrain; //Виводиться numbTrain і тд.
						cout.width(20);
						cout << namePlatf;
						cout.width(13);
						cout << depertureTime.tm_hour <<":" << depertureTime.tm_min;
						cout.width(15);
						cout << arrivalTime.tm_hour << ":" << arrivalTime.tm_min;
						cout.width(15);
						cout <<  arrivalTime.tm_hour - depertureTime.tm_hour
							<< "  Hour  " << arrivalTime.tm_min - depertureTime.tm_min <<"  Min  " ;
						cout << endl;
					}
				}
				infile.close();  // Закриття роботи з файлом
		}
		if (choice == 2)
		{
			// Ввід з клавіатури інформацію
			cout << "Введите номер поезда:" << endl;
			cin >> numbTrain;
			cout << "Введите направление поезда:" << endl;
			cin >> namePlatf;
			cout << "время отправления:" << endl;
			cin >> get_time(&depertureTime, "%R");
			cout << "время прибытия:" << endl;
			cin >> get_time(&arrivalTime, "%R");
			if (std::cin.fail()) std::cout << "Error reading time\n";
			else {
				fstream outfile("File.txt", ios::app); //Відкриваю файл для додавання в кінець тексту
				if (!outfile)							// Якщо файл відсутній - вивести помилку
				{
					cout << "Cannot open file" << endl;
					return -1;
				}
				outfile.setf(ios::left);  //Вивід файлу з вирівненням по лівому краю поля
			 //відступ.заповнення графіку 
				outfile.width(20);
				outfile << numbTrain << ' ';
				outfile.width(20);
				outfile << namePlatf << ' ';
				outfile.width(5);
				outfile << depertureTime.tm_hour <<":"<< depertureTime.tm_min << ' ';
				outfile.width(5);
				outfile << arrivalTime.tm_hour << ":" << arrivalTime.tm_min << endl;
				outfile.close();
			}
		}
		if (choice == 3)
		{
			break;
		}
	}
}
 
